<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Adatbázis Címkekezelő</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script src="js/jsQR.min.js"></script>
  <style>
    /* Az eredeti CSS itt marad változatlanul */
  </style>
</head>
<body>
  <h1>AI Adatbázis Címkekezelő</h1>
  
  <div class="version-info">
    <p>Verzió: <span id="version-number">2.3.11</span></p>
    <button onclick="showVersionHistory()">Verzió Történet</button>
  </div>
  <div id="version-history-popup">
    <h3>Verzió Történet</h3>
    <ul>
      <li><strong>2.3.11</strong> – Javítva a gépek adatainak betöltése a Beállítások lapon; hozzáadva admin jelszavas védelem a Beállítások laphoz; mock-data.json integráció.</li>
      <li><strong>2.3.10</strong> – Javítva a belső rendelési számok és költséghelyek megjelenítése a Foglalási Lista és Beállítások lapon.</li>
      <!-- További verzió történetek... -->
    </ul>
    <button onclick="closeVersionHistory()">Bezárás</button>
  </div>

  <nav>
    <span class="nav-link" onclick="showLap(1)">QR Kód Generálás</span>
    <span class="nav-link" onclick="showLap(2)">QR Kód Olvasás (Foglalás)</span>
    <span class="nav-link" onclick="showLap(3)">Foglalási Lista</span>
    <span class="nav-link" onclick="showLap(4)">Segítség</span>
    <span class="nav-link" onclick="showSettings()">Beállítások</span>
  </nav>

  <!-- Lapok (lap1, lap2, lap3, lap4, lap5) itt maradnak változatlanul az előző kód alapján -->

  <script>
    // Lapváltás
    function showLap(lap) {
      var lapok = document.querySelectorAll('.lap-content');
      lapok.forEach(function(lapContent) {
        lapContent.classList.remove('active');
      });
      document.getElementById('lap' + lap).classList.add('active');
      if (lap === 2) updateMachineDropdown();
    }

    // Beállítások lap jelszavas védelme
    function showSettings() {
      document.getElementById("settings-password-popup").style.display = "block";
    }

    function checkSettingsPassword() {
      const password = document.getElementById("settings-password").value;
      if (password === "admin") {
        document.getElementById("settings-password-popup").style.display = "none";
        document.getElementById("lap5").style.display = "block";
        updateMachineTable();
      } else {
        document.getElementById("settings-password-error").textContent = "Helytelen jelszó!";
      }
      document.getElementById("settings-password").value = "";
    }

    function closeSettingsPopup() {
      document.getElementById("settings-password-popup").style.display = "none";
      document.getElementById("settings-password").value = "";
      document.getElementById("settings-password-error").textContent = "";
    }

    // Verziótörténet megjelenítése és bezárása
    function showVersionHistory() {
      document.getElementById("version-history-popup").style.display = "block";
    }
    function closeVersionHistory() {
      document.getElementById("version-history-popup").style.display = "none";
    }

    // ... (további függvények, pl. generateQRCode, startQRReader, stb. változatlanok)

    // Gépek JSON-ból történő betöltése
    async function loadGepek() {
      try {
        const response = await fetch('mock-data.json');
        if (!response.ok) throw new Error('Hiba a JSON betöltésekor');
        const gepek = await response.json();
        localStorage.setItem('gepek', JSON.stringify(gepek));
        return gepek;
      } catch (error) {
        console.error('Hiba a mock-data.json betöltésekor:', error);
        // Ha a JSON betöltése nem sikerül, üres objektumot adunk vissza
        return {
          "MFC-terület": [],
          "MFS-terület": [],
          "MFH-terület": [],
          "M2B-terület": []
        };
      }
    }

    // Gépek inicializálása betöltéskor
    let gepek = JSON.parse(localStorage.getItem('gepek'));
    if (!gepek || Object.keys(gepek).length === 0 || !gepek["MFC-terület"] || !gepek["MFS-terület"] || !gepek["MFH-terület"] || !gepek["M2B-terület"]) {
      loadGepek().then(data => {
        gepek = data;
        localStorage.setItem('gepek', JSON.stringify(gepek));
        if (document.getElementById("lap5").style.display === "block") updateMachineTable();
        if (document.getElementById("lap2").classList.contains("active")) updateMachineDropdown();
      });
    }

    // Gépek táblázat frissítése
    function updateMachineTable() {
      const tbody = document.getElementById("machine-body");
      tbody.innerHTML = "";
      for (let terulet in gepek) {
        if (gepek[terulet] && Array.isArray(gepek[terulet])) {
          gepek[terulet].forEach(gep => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${terulet}</td>
              <td>${gep.nev || 'N/A'}</td>
              <td>${gep.rendelesiSzam || 'N/A'}</td>
              <td>${gep.koltseghelySzam || 'N/A'}</td>
              <td><button onclick="deleteMachine('${terulet}', '${gep.nev}')" style="background-color: #FF0000; color: white; width: 30px; height: 30px; border: none; border-radius: 5px;">T</button></td>
            `;
            tbody.appendChild(row);
          });
        }
      }
      localStorage.setItem('gepek', JSON.stringify(gepek));
    }

    function deleteMachine(terulet, nev) {
      if (confirm(`Biztosan törlöd a(z) ${nev} gépet a(z) ${terulet} területről?`)) {
        gepek[terulet] = gepek[terulet].filter(g => g.nev !== nev);
        if (gepek[terulet].length === 0) delete gepek[terulet];
        localStorage.setItem('gepek', JSON.stringify(gepek));
        updateMachineTable();
        updateMachineDropdown();
      }
    }

    function addMachine() {
      const terulet = prompt("Add meg a területet (pl. MFC-terület):");
      const nev = prompt("Add meg a gép nevét:");
      const rendelesiSzam = prompt("Add meg a belső rendelési számot (üresen hagyható):") || "";
      const koltseghelySzam = prompt("Add meg a költséghely számot:") || (terulet === "M2B-terület" ? "15009131" : "15009126");
      if (terulet && nev) {
        if (!gepek[terulet]) gepek[terulet] = [];
        if (!gepek[terulet].some(g => g.nev === nev)) {
          gepek[terulet].push({ nev, rendelesiSzam, koltseghelySzam });
          localStorage.setItem('gepek', JSON.stringify(gepek));
          updateMachineTable();
          updateMachineDropdown();
        } else {
          alert("Ez a gép már létezik ezen a területen!");
        }
      }
    }

    document.getElementById("add-machine-btn").addEventListener("click", addMachine);

    // Lista inicializálása betöltéskor
    window.onload = async function() {
      updateFoglalasLista();
      // Az updateMachineTable itt nem fut, mert a Beállítások lap jelszóval védett
    };

    // ... (további függvények, pl. updateMachineDropdown, saveFoglalas, stb. változatlanok)
  </script>
</body>
</html>
